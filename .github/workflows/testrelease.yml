name: Release Arturo app

on:
  push:
    tags:
      - 'v*.*.*'

concurrency: 
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true
 
jobs:
    Bundle:
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                os:
                    - ubuntu-latest 
                    # - macos-12              # amd64
                    # - macos-latest          # arm64 / M1
                    # - windows-latest
        outputs:
            name: ${{ steps.bundler.outputs.name }}
            version: ${{ steps.bundler.outputs.version }}
        steps:
            - uses: actions/checkout@v4
            - uses: ./
              id: bundler
              with: 
                token: ${{ secrets.GITHUB_TOKEN }}
                entry: tests/testbundle.art
                version: 1.0.0
                release: 'true'
            - run: |
                echo "name=${{ env.name }}" >> $GITHUB_OUTPUT
                echo "version=${{ env.version }}" >> $GITHUB_OUTPUT
              shell: bash
    
    Release:
        runs-on: ubuntu-latest
        if: ${{ always() }}
        needs: Bundle
        steps:
            - uses: actions/checkout@v4
            - uses: arturo-lang/bundler-releases@main
              with:
                token: ${{ secrets.GITHUB_TOKEN }}
                name: ${{ needs.Bundle.outputs.name }}
                version: ${{ needs.Bundle.outputs.version }}