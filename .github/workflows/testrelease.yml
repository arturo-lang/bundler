name: Release Arturo app

env:
  app-name: testbundlex
  app-entry: tests/testbundle.art
  app-description: 

on:
    push:
      tags:
        - 'v*.*.*'

concurrency: 
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true
 
jobs:
    Bundle:
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                os:
                    - ubuntu-latest 
                    # - macos-12              # amd64
                    # - macos-latest          # arm64 / M1
                    # - windows-latest
        steps:
            - uses: actions/checkout@v4
            - uses: ./
              with: 
                token: ${{ secrets.GITHUB_TOKEN }}
                entry: ${{ env.app-entry }}
                target: ${{ env.app-name}}
                release: 'true'
    
    Release:
        runs-on: ubuntu-latest
        if: ${{ always() }}
        needs: Bundle
        steps:
            - uses: actions/checkout@v4
            - uses: arturo-lang/bundler-releases@main
              with:
                token: ${{ secrets.GITHUB_TOKEN }}
                name: ${{ env.app-name }}
                description: ${{ env.app-description }}